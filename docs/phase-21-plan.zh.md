# Phase 21：存储清理

## 概述

Phase 21 添加存储清理器，管理数据生命周期，删除可配置保留高度以下的旧区块/日志，并提供存储统计。

## 组件

### StoragePruner (`storage/pruner.ts`)
- 可配置保留：保留链顶端 N 个区块（默认 10,000）
- 批量清理：每次运行最多处理 N 个区块（默认 100）
- 移除区块数据（按编号和哈希索引）、日志
- 将清理高度持久化到 DB，支持跨重启恢复
- 自动清理模式，可配置间隔（默认 5 分钟）
- 存储统计：最新区块、清理高度、保留区块数
- `prune()` 返回详细结果（移除的区块/交易/日志数、耗时）

### 配置
- `retentionBlocks`：保留多少区块（默认 10,000）
- `pruneIntervalMs`：自动清理间隔（默认 300,000ms）
- `batchSize`：每次清理最大区块数（默认 100）
- `enableAutoPrune`：启用基于间隔的清理

## 测试覆盖

- `storage/pruner.test.ts`：8 个测试（全部通过）
- 覆盖：基本清理、批量限制、无操作、持久化、统计、哈希索引清理、空 DB、耗时追踪

## 状态：已完成
